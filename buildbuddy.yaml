actions:
  - name: Test
    container_image: ubuntu-20.04
    triggers:
      push:
        branches:
          - "*"
      pull_request:
        branches:
          - "master"
    resource_requests:
      cpu: 6
      memory: 12GB
    bazel_commands:
      - run //:setup_ci --config=workflows
      - --bazelrc=custom.bazelrc build //... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR
      - --bazelrc=custom.bazelrc test //server/util/... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR --build_tests_only
      - run //:setup_ci --config=workflows
      - --bazelrc=custom.bazelrc build //... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR
      - --bazelrc=custom.bazelrc test //server/util/... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR --build_tests_only
      - run //:setup_ci --config=workflows
      - --bazelrc=custom.bazelrc build //... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR
      - --bazelrc=custom.bazelrc test //server/util/... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR --build_tests_only
      # - run //:setup_ci --config=workflows
      # - --bazelrc=custom.bazelrc build //server/util/... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR
      # - --bazelrc=custom.bazelrc test //server/util/... --config=workflows --build_tag_filters=-no-bazelci --repo_env=FOO=BAR --build_tests_only
