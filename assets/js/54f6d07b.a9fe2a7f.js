/*! For license information please see 54f6d07b.a9fe2a7f.js.LICENSE.txt */
"use strict";(self.webpackChunkbuildbuddy_docs_website=self.webpackChunkbuildbuddy_docs_website||[]).push([[2002],{2525:function(e){var n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function l(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map((function(e){return n[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(l){return!1}}()?Object.assign:function(e,a){for(var r,o,p=l(e),u=1;u<arguments.length;u++){for(var s in r=Object(arguments[u]))t.call(r,s)&&(p[s]=r[s]);if(n){o=n(r);for(var c=0;c<o.length;c++)i.call(r,o[c])&&(p[o[c]]=r[o[c]])}}return p}},1535:function(e,n,t){var i=t(2525),l="function"==typeof Symbol&&Symbol.for,a=l?Symbol.for("react.element"):60103,r=l?Symbol.for("react.portal"):60106,o=l?Symbol.for("react.fragment"):60107,p=l?Symbol.for("react.strict_mode"):60108,u=l?Symbol.for("react.profiler"):60114,s=l?Symbol.for("react.provider"):60109,c=l?Symbol.for("react.context"):60110,d=l?Symbol.for("react.forward_ref"):60112,h=l?Symbol.for("react.suspense"):60113,m=l?Symbol.for("react.memo"):60115,g=l?Symbol.for("react.lazy"):60116,b="function"==typeof Symbol&&Symbol.iterator;function f(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k={};function _(e,n,t){this.props=e,this.context=n,this.refs=k,this.updater=t||y}function v(){}function N(e,n,t){this.props=e,this.context=n,this.refs=k,this.updater=t||y}_.prototype.isReactComponent={},_.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,n,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var w=N.prototype=new v;w.constructor=N,i(w,_.prototype),w.isPureReactComponent=!0;var x={current:null},C=Object.prototype.hasOwnProperty,O={key:!0,ref:!0,__self:!0,__source:!0};function E(e,n,t){var i,l={},r=null,o=null;if(null!=n)for(i in void 0!==n.ref&&(o=n.ref),void 0!==n.key&&(r=""+n.key),n)C.call(n,i)&&!O.hasOwnProperty(i)&&(l[i]=n[i]);var p=arguments.length-2;if(1===p)l.children=t;else if(1<p){for(var u=Array(p),s=0;s<p;s++)u[s]=arguments[s+2];l.children=u}if(e&&e.defaultProps)for(i in p=e.defaultProps)void 0===l[i]&&(l[i]=p[i]);return{$$typeof:a,type:e,key:r,ref:o,props:l,_owner:x.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var I=/\/+/g,P=[];function T(e,n,t,i){if(P.length){var l=P.pop();return l.result=e,l.keyPrefix=n,l.func=t,l.context=i,l.count=0,l}return{result:e,keyPrefix:n,func:t,context:i,count:0}}function z(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>P.length&&P.push(e)}function j(e,n,t,i){var l=typeof e;"undefined"!==l&&"boolean"!==l||(e=null);var o=!1;if(null===e)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case a:case r:o=!0}}if(o)return t(i,e,""===n?"."+A(e,0):n),1;if(o=0,n=""===n?".":n+":",Array.isArray(e))for(var p=0;p<e.length;p++){var u=n+A(l=e[p],p);o+=j(l,u,t,i)}else if(null===e||"object"!=typeof e?u=null:u="function"==typeof(u=b&&e[b]||e["@@iterator"])?u:null,"function"==typeof u)for(e=u.call(e),p=0;!(l=e.next()).done;)o+=j(l=l.value,u=n+A(l,p++),t,i);else if("object"===l)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t,""));return o}function $(e,n,t){return null==e?0:j(e,"",n,t)}function A(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return n[e]}))}(e.key):n.toString(36)}function R(e,n){e.func.call(e.context,n,e.count++)}function B(e,n,t){var i=e.result,l=e.keyPrefix;e=e.func.call(e.context,n,e.count++),Array.isArray(e)?L(e,i,t,(function(e){return e})):null!=e&&(S(e)&&(e=function(e,n){return{$$typeof:a,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(e,l+(!e.key||n&&n.key===e.key?"":(""+e.key).replace(I,"$&/")+"/")+t)),i.push(e))}function L(e,n,t,i,l){var a="";null!=t&&(a=(""+t).replace(I,"$&/")+"/"),$(e,B,n=T(n,a,i,l)),z(n)}var D={current:null};function U(){var e=D.current;if(null===e)throw Error(f(321));return e}},7378:function(e,n,t){t(1535)},4137:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return h}});var i=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,i,l=function(e,n){if(null==e)return{};var t,i,l={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var p=i.createContext({}),u=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},s=function(e){var n=u(e.components);return i.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},d=i.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=u(t),h=l,m=d["".concat(p,".").concat(h)]||d[h]||c[h]||a;return t?i.createElement(m,r(r({ref:n},s),{},{components:t})):i.createElement(m,r({ref:n},s))}));function h(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,r=new Array(a);r[0]=d;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var u=2;u<a;u++)r[u]=t[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6302:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return u},toc:function(){return s},default:function(){return d}});var i=t(7462),l=t(3366),a=(t(7378),t(4137)),r=["components"],o={id:"cli-plugins",title:"CLI Plugins",sidebar_label:"CLI Plugins"},p=void 0,u={unversionedId:"cli-plugins",id:"cli-plugins",title:"CLI Plugins",description:"The BuildBuddy CLI comes with a robust plugin system. Plugins are super simple to write, share, and install.",source:"@site/../docs/cli-plugins.md",sourceDirName:".",slug:"/cli-plugins",permalink:"/docs/cli-plugins",editUrl:"https://github.com/buildbuddy-io/buildbuddy/edit/master/docs/../docs/cli-plugins.md",tags:[],version:"current",lastUpdatedBy:"Siggi Simonarson",lastUpdatedAt:1668535062,formattedLastUpdatedAt:"11/15/2022",frontMatter:{id:"cli-plugins",title:"CLI Plugins",sidebar_label:"CLI Plugins"},sidebar:"someSidebar",previous:{title:"CLI Overview",permalink:"/docs/cli"},next:{title:"Troubleshooting",permalink:"/docs/troubleshooting"}},s=[{value:"Installing a plugin",id:"installing-a-plugin",children:[{value:"Example",id:"example",children:[],level:3},{value:"Syntax",id:"syntax",children:[{value:"REPO",id:"repo",children:[],level:4},{value:"VERSION",id:"version",children:[],level:4},{value:"PATH",id:"path",children:[],level:4}],level:3},{value:"User specific plugins",id:"user-specific-plugins",children:[],level:3},{value:"Manual install",id:"manual-install",children:[],level:3}],level:2},{value:"Creating a plugin",id:"creating-a-plugin",children:[{value:"<code>pre_bazel.sh</code>",id:"pre_bazelsh",children:[],level:3},{value:"<code>post_bazel.sh</code>",id:"post_bazelsh",children:[],level:3},{value:"<code>handle_bazel_output.sh</code>",id:"handle_bazel_outputsh",children:[],level:3},{value:"Environment variables",id:"environment-variables",children:[{value:"$BUILD_WORKSPACE_DIRECTORY",id:"build_workspace_directory",children:[],level:4},{value:"$PLUGIN_TEMPDIR",id:"plugin_tempdir",children:[],level:4},{value:"$USER_CONFIG_DIR",id:"user_config_dir",children:[],level:4}],level:3},{value:"Examples",id:"examples",children:[],level:3}],level:2},{value:"Sharing a plugin",id:"sharing-a-plugin",children:[],level:2},{value:"Uninstalling a plugin",id:"uninstalling-a-plugin",children:[],level:2}],c={toc:s};function d(e){var n=e.components,t=(0,l.Z)(e,r);return(0,a.kt)("wrapper",(0,i.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The BuildBuddy CLI comes with a robust plugin system. Plugins are super simple to write, share, and install."),(0,a.kt)("p",null,"You can find a list of plugins that you can install in our ",(0,a.kt)("a",{parentName:"p",href:"/plugins"},"plugin library"),"."),(0,a.kt)("h2",{id:"installing-a-plugin"},"Installing a plugin"),(0,a.kt)("p",null,"Plugins can be installed using the ",(0,a.kt)("inlineCode",{parentName:"p"},"bb install")," command."),(0,a.kt)("h3",{id:"example"},"Example"),(0,a.kt)("p",null,"Here's an example of a command that installs the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/buildbuddy-io/plugins/tree/main/open-invocation#readme"},"open-invocation plugin"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bb install buildbuddy-io/plugins:open-invocation\n")),(0,a.kt)("p",null,"This is shorthand for:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bb install https://github.com/buildbuddy-io/plugins@main:open-invocation\n")),(0,a.kt)("h3",{id:"syntax"},"Syntax"),(0,a.kt)("p",null,"The syntax for the install command is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bb install [REPO][@VERSION][:PATH]\n")),(0,a.kt)("p",null,"Notice the 3 components that define the plugin being installed: ",(0,a.kt)("strong",{parentName:"p"},"REPO"),", ",(0,a.kt)("strong",{parentName:"p"},"VERSION"),", and ",(0,a.kt)("strong",{parentName:"p"},"PATH")," which are all optional."),(0,a.kt)("p",null,"Either a ",(0,a.kt)("strong",{parentName:"p"},"REPO")," or a ",(0,a.kt)("strong",{parentName:"p"},"PATH")," must be specified (otherwise, the CLI wouldn't know what plugin to install)."),(0,a.kt)("p",null,"Below is a detailed description of each of these components."),(0,a.kt)("h4",{id:"repo"},"REPO"),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"REPO")," component defines a git repository from which to install the plugin. If ",(0,a.kt)("strong",{parentName:"p"},"REPO")," is omitted, the CLI will look for a plugin in the current repository based on the ",(0,a.kt)("strong",{parentName:"p"},"PATH")," component."),(0,a.kt)("p",null,"This makes it easy to write new plugins directly within your existing repo, without having to create a new repo per plugin."),(0,a.kt)("p",null,"You can specify the ",(0,a.kt)("strong",{parentName:"p"},"REPO")," component as a fully qualified git url, like ",(0,a.kt)("inlineCode",{parentName:"p"},"github.com/buildbuddy-io/plugins")," or using a shorthand owner/repo notation like ",(0,a.kt)("inlineCode",{parentName:"p"},"buildbuddy-io/plugins"),", in which case ",(0,a.kt)("inlineCode",{parentName:"p"},"github.com/")," will automatically be prepended."),(0,a.kt)("h4",{id:"version"},"VERSION"),(0,a.kt)("p",null,"This allows you to lock a plugin to a specific git tag, branch, or commit SHA. If ",(0,a.kt)("strong",{parentName:"p"},"VERSION")," is omitted, the CLI will pull the plugin from head."),(0,a.kt)("h4",{id:"path"},"PATH"),(0,a.kt)("p",null,"A BuildBuddy CLI plugin is simply a directory. The ",(0,a.kt)("strong",{parentName:"p"},"PATH")," component defines the directory in which the plugin is contained. If no path is specified, the BuildBuddy CLI look for a plugin in the repository's root directory."),(0,a.kt)("h3",{id:"user-specific-plugins"},"User specific plugins"),(0,a.kt)("p",null,"By default plugins are installed at the repository level. They are saved in the ",(0,a.kt)("inlineCode",{parentName:"p"},"buildbuddy.yaml")," file in the root of your repository."),(0,a.kt)("p",null,"Sometimes you may want to install a plugin for yourself (like a theme plugin for example), but don't want to force it on everyone on your project. In that case, you can install a plugin as a user-specific plugin."),(0,a.kt)("p",null,"Installing a plugin as user-specific is as simple as just tacking the ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," argument onto your ",(0,a.kt)("inlineCode",{parentName:"p"},"bb install")," command."),(0,a.kt)("p",null,"When the ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," argument is present, the plugin will be added to a ",(0,a.kt)("inlineCode",{parentName:"p"},"~/buildbuddy.yaml")," file located in your user directory. That means those plugins will only be applied to you."),(0,a.kt)("p",null,"If a plugin is present in both your user-specific and workspace at differnet versions, the one in your workspace will take precedence."),(0,a.kt)("h3",{id:"manual-install"},"Manual install"),(0,a.kt)("p",null,"You can manually install plugins by editing your ",(0,a.kt)("inlineCode",{parentName:"p"},"buildbuddy.yaml")," file with a text editor."),(0,a.kt)("p",null,"They live under a ",(0,a.kt)("inlineCode",{parentName:"p"},"plugins:")," section, like so:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"plugins:\n  # Local plugins\n  - path: cli/example_plugins/go-highlight\n  - path: cli/example_plugins/ping-remote\n  # Plugins in external repos\n  - path: cli/plugins/go-deps\n    repo: buildbuddy-io/plugins\n  - path: cli/plugins/open-invocation\n    repo: buildbuddy-io/plugins\n  - path: cli/plugins/notify\n    repo: buildbuddy-io/plugins\n  - path: cli/plugins/theme-modern\n    repo: buildbuddy-io/plugins\n  # Single-plugin repo\n  - repo: bduffany/go-highlight\n")),(0,a.kt)("p",null,"You can check out our ",(0,a.kt)("inlineCode",{parentName:"p"},"buildbuddy.yaml")," file ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/buildbuddy-io/buildbuddy/blob/master/buildbuddy.yaml#L55"},"here"),"."),(0,a.kt)("h2",{id:"creating-a-plugin"},"Creating a plugin"),(0,a.kt)("p",null,"Creating a plugin is simple, it's just a directory. The directory can live within your repo, or in a separate repository."),(0,a.kt)("p",null,"There are 3 files you can place in your plugin directory, each corresponding to different a hook."),(0,a.kt)("p",null,"The files are simply bash scripts, which gives you the flexibility to write them in any language you want."),(0,a.kt)("p",null,"A single plugin can contain multiple hook scripts."),(0,a.kt)("p",null,"The directory layout for a plugin looks like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"path/to/plugin/\n\u251c\u2500\u2500 pre_bazel.sh            # optional\n\u251c\u2500\u2500 post_bazel.sh           # optional\n\u2514\u2500\u2500 handle_bazel_output.sh  # optional\n")),(0,a.kt)("h3",{id:"pre_bazelsh"},(0,a.kt)("inlineCode",{parentName:"h3"},"pre_bazel.sh")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.sh")," script will be called before Bazel is run."),(0,a.kt)("p",null,"It is called with a single argument, which is the path to a file\ncontaining all arguments that will be passed to Bazel (including the\narguments specified in your ",(0,a.kt)("inlineCode",{parentName:"p"},".bazelrc")," and expanded via any ",(0,a.kt)("inlineCode",{parentName:"p"},"--config="),"\nflags). ",(0,a.kt)("strong",{parentName:"p"},"Each line in this file contains a single argument.")),(0,a.kt)("p",null,"The script will be called like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/bin/env bash /path/to/plugin/pre_bazel.sh /path/to/bazel-args\n")),(0,a.kt)("p",null,"Here's an example of what the Bazel args file might look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"--ignore_all_rc_files\nrun\n//server\n--bes_results_url=https://app.buildbuddy.io/invocation/\n--bes_backend=grpcs://remote.buildbuddy.io\n--noremote_upload_local_results\n--workspace_status_command=$(pwd)/workspace_status.sh\n--incompatible_remote_build_event_upload_respect_no_cache\n--experimental_remote_cache_async\n--incompatible_strict_action_env\n--enable_runfiles=1\n--build_tag_filters=-docker\n--bes_results_url=https://app.buildbuddy.io/invocation/\n--bes_backend=grpcs://remote.buildbuddy.io\n--remote_cache=grpcs://remote.buildbuddy.io\n--remote_upload_local_results\n--experimental_remote_cache_compression\n--noremote_upload_local_results\n--noincompatible_remote_build_event_upload_respect_no_cache\n")),(0,a.kt)("p",null,"Your plugin can modify this file to add, remove, or change that flags that will ultimately be passed to Bazel."),(0,a.kt)("p",null,"Your ",(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.sh")," script can also accept user input, spawn other processes, or anything else you'd like."),(0,a.kt)("p",null,"Here's an example of a simple ",(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.sh")," plugin that disables remote execution if it's unable to ping ",(0,a.kt)("inlineCode",{parentName:"p"},"remote.buildbuddy.io")," within 500ms."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'if ! grep -E \'^--remote_executor=.*\\.buildbuddy\\.io$\' "$1" &>/dev/null; then\n  # BB remote execution is not enabled; do nothing.\n  exit 0\nfi\n\n# Make sure we can ping the remote execution service in 500ms.\nif ! timeout 0.5 ping -c 1 remote.buildbuddy.io &>/dev/null; then\n  # Network is spotty; disable remote execution.\n  echo "--remote_executor=" >>"$1"\nfi\n')),(0,a.kt)("p",null,"Because this is just a bash script, you can write your pre Bazel logic in python, js, or any other language you'd like."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.sh")," script is also a great place for more complex plugins to make sure all of their dependencies are available / installed."),(0,a.kt)("p",null,"Here's example of a ",(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.sh")," script that makes sure both ",(0,a.kt)("inlineCode",{parentName:"p"},"python3")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"open")," are installed, and then calls into a python script called ",(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.py"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'if ! which python3 &>/dev/null; then\n  echo -e "\\x1b[33mWarning: open-invocation plugin is disabled: missing \'python3\' in \\$PATH\\x1b[m" >&2\n  exit 0\nfi\nopen_command=$( (which xdg-open open | head -n1) || true)\nif [[ ! "$open_command" ]]; then\n  echo -e "\\x1b[33mWarning: open-invocation plugin is disabled: missing \'open\' or \'xdg-open\' in \\$PATH\\x1b[m" >&2\n  exit\nfi\n\nexec python3 ./pre_bazel.py "$@"\n')),(0,a.kt)("h3",{id:"post_bazelsh"},(0,a.kt)("inlineCode",{parentName:"h3"},"post_bazel.sh")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"post_bazel.sh")," script is called after Bazel completes. It is called with a single argument, which contains the console output that was generated by Bazel. This allows you to analyze Bazel's output and perform actions based on these outputs."),(0,a.kt)("p",null,"The script will be called like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/bin/env bash /path/to/plugin/post_bazel.sh /path/to/bazel-outputs\n")),(0,a.kt)("p",null,"Here's an example of what the Bazel outputs file might look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"INFO: Invocation ID: cd254c65-c657-4524-b084-15a20d4485d1\nINFO: Streaming build results to: https://app.buildbuddy.io/invocation/cd254c65-c657-4524-b084-15a20d4485d1\nDEBUG: /root/workspace/output-base/external/io_bazel_rules_k8s/toolchains/kubectl/kubectl_toolchain.bzl:28:14: No kubectl tool was found or built, executing run for rules_k8s targets might not work.\nINFO: Analyzed 1212 targets (345 packages loaded, 28870 targets configured).\nINFO: Found 1042 targets and 170 test targets...\nINFO: Elapsed time: 67.685s, Critical Path: 10.30s\nINFO: 5868 processes: 5866 remote cache hit, 1 internal, 1 remote.\n//app:app_typecheck_test                                        (cached) PASSED in 0.4s\n//server/util/terminal:terminal_test                            (cached) PASSED in 0.7s\n//server/util/url:url_test                                      (cached) PASSED in 0.4s\n//enterprise/server/remote_execution/containers/sandbox:sandbox_test    SKIPPED\n\nExecuted 0 out of 170 tests: 169 tests pass and 1 was skipped.\nThere were tests whose specified size is too big. Use the --test_verbose_timeout_warnings command line option to see which ones these are.\n")),(0,a.kt)("p",null,"Your ",(0,a.kt)("inlineCode",{parentName:"p"},"post_bazel.sh")," script can also accept user input, spawn other processes, or anything else you'd like."),(0,a.kt)("p",null,"Here's an example of a simple plugin that sends a desktop notification once the build completes:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'set -eu\n\nSTATUS_LINE=$(grep "Build" "$1" | grep "complete" | tail -n1 | perl -p -e \'s@.*?(Build)@\\1@\')\nELAPSED_TIME_LINE=$(grep "Elapsed time" "$1" | tail -n1 | perl -p -e \'s@.*?(Elapsed)@\\1@\')\n\nTITLE="Bazel build finished"\nMESSAGE="${ELAPSED_TIME_LINE}\\n${STATUS_LINE}"\n\nif [[ "$OSTYPE" == darwin* ]]; then\n  SCRIPT="display notification \\"$MESSAGE\\" with title \\"$TITLE\\""\n\n  osascript -e "$SCRIPT"\n  exit 0\nfi\n\nnotify-send --expire-time 3000 "$TITLE" "$MESSAGE"\n')),(0,a.kt)("p",null,"Here's another example of a more complex plugin, that simply calls a python script name ",(0,a.kt)("inlineCode",{parentName:"p"},"post_bazel.py")," after checking that ",(0,a.kt)("inlineCode",{parentName:"p"},"python3")," is installed:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'if ! which python3 &>/dev/null; then\n  echo -e "\\x1b[33mWarning: go-deps plugin is disabled: missing \'python3\' in \\$PATH\\x1b[m" >&2\n  exit 0\nfi\nexec python3 ./post_bazel.py "$@"\n')),(0,a.kt)("h3",{id:"handle_bazel_outputsh"},(0,a.kt)("inlineCode",{parentName:"h3"},"handle_bazel_output.sh")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"handle_bazel_output.sh")," script is piped all Bazel output during a build via stdin. This allows you to transform and modify the output that Bazel displays to users."),(0,a.kt)("p",null,"Here's a simple script that calls a python script ",(0,a.kt)("inlineCode",{parentName:"p"},"handle_bazel_output.py"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'if ! which python3 &>/dev/null; then\n  echo -e "\\x1b[33mWarning: go-highlight plugin is disabled: missing \'python3\' in \\$PATH\\x1b[m" >&2\n  exec cat\nfi\nexec python3 ./handle_bazel_output.py "$@"\n')),(0,a.kt)("p",null,"::: note"),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"handle_bazel_output.sh")," fails to find one of its required system\ndependencies, it can fall back to running ",(0,a.kt)("inlineCode",{parentName:"p"},"cat")," so that the plugin\neffectively becomes a no-op."),(0,a.kt)("p",null,":::"),(0,a.kt)("p",null,"Here is the Python script ",(0,a.kt)("inlineCode",{parentName:"p"},"handle_bazel_output.py")," from the\n",(0,a.kt)("inlineCode",{parentName:"p"},"go-highlight")," plugin:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py"},'import re\nimport sys\n\nif __name__ == "__main__":\n    for line in sys.stdin:\n        m = re.search(r"^(.*?\\.go:\\d+:\\d+:)(.*)", line)\n        if m:\n            print("\\x1b[33m" + m.group(1) + "\\x1b[0m" + m.group(2))\n        else:\n            print(line, end="")\n\n')),(0,a.kt)("p",null,"Or another ",(0,a.kt)("inlineCode",{parentName:"p"},"handle_bazel_output.py")," python script that changes the colors of various Bazel outputs:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py"},'import re\nimport sys\n\ndefault_green = "\\x1b[32m"\nbright_green_bold = "\\x1b[92;1m"\nbright_cyan_bold = "\\x1b[96;1m"\nbright_white_bold_underline = "\\x1b[37;1;4m"\nreset = "\\x1b[0m"\n\nif __name__ == "__main__":\n    for line in sys.stdin:\n        line = line.replace(default_green+"INFO", bright_green_bold+"INFO")\n        line = line.replace(default_green+"Loading", bright_cyan_bold+"Loading")\n        line = line.replace(default_green+"Analyzing", bright_cyan_bold+"Analyzing")\n        line = line.replace(default_green+"[", bright_cyan_bold+"[")\n        m = re.search(r"^(.*)(Streaming build results to: )(.*)$", line)\n        if m:\n            print(m.group(1) + m.group(2) + bright_white_bold_underline + m.group(3) + reset)\n        else:\n            print(line, end="")\n')),(0,a.kt)("h3",{id:"environment-variables"},"Environment variables"),(0,a.kt)("p",null,"The CLI exposes certain environment variables to your plugins."),(0,a.kt)("h4",{id:"build_workspace_directory"},"$BUILD_WORKSPACE_DIRECTORY"),(0,a.kt)("p",null,"This is the path to the Bazel workspace in which the CLI is run. It is the\nroot path, containing the bazel ",(0,a.kt)("inlineCode",{parentName:"p"},"WORKSPACE")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"WORKSPACE.bazel")," file."),(0,a.kt)("h4",{id:"plugin_tempdir"},"$PLUGIN_TEMPDIR"),(0,a.kt)("p",null,"This is a temporary directory that can be used by your plugin to store temporary files. These files will be cleaned up after the invocation is complete."),(0,a.kt)("h4",{id:"user_config_dir"},"$USER_CONFIG_DIR"),(0,a.kt)("p",null,"This is a long-lived directory you can use to store user preferences, like whether or not a user always wants to automatically apply a particular fix."),(0,a.kt)("p",null,"Your plugin is responsible for provisioning its own directory under this\nconfig dir, if needed, using something like\n",(0,a.kt)("inlineCode",{parentName:"p"},"mkdir -p $USER_CONFIG_DIR/my-plugin"),". If you store user preferences here,\nyou'll need to decide how to handle differences in preferences across\ndifferent versions of your plugin."),(0,a.kt)("h3",{id:"examples"},"Examples"),(0,a.kt)("p",null,"Here are some examples of plugins that can help you get started quickly:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"pre_bazel.sh")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ping-remote: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/example_plugins/ping-remote"},"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/example_plugins/ping-remote"))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"post_bazel.sh")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"open-invocation: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/plugins/open-invocation"},"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/plugins/open-invocation")),(0,a.kt)("li",{parentName:"ul"},"notify: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/plugins/notify"},"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/plugins/notify")),(0,a.kt)("li",{parentName:"ul"},"go-deps: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/plugins/go-deps"},"https://github.com/buildbuddy-io/buildbuddy/tree/master/cli/plugins/go-deps"))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"handle_bazel_output.sh")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"go-highlight: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/bduffany/go-highlight"},"https://github.com/bduffany/go-highlight")),(0,a.kt)("li",{parentName:"ul"},"theme-modern: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/siggisim/theme-modern"},"https://github.com/siggisim/theme-modern"))),(0,a.kt)("h2",{id:"sharing-a-plugin"},"Sharing a plugin"),(0,a.kt)("p",null,"Because a plugin is just a directory in a repo, sharing plugins is super easy."),(0,a.kt)("p",null,"You can either a single plugin in a repo, like ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/bduffany/go-highlight"},"this")," or host multiple plugins in a repo like ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/buildbuddy-io/plugins"},"this"),"."),(0,a.kt)("p",null,"For single plugin repos, others can install your plugin with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bb install your-username/your-repo\n")),(0,a.kt)("p",null,"For multi plugin repos, others can install your plugin with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bb install your-username/your-repo:path-to-repo\n")),(0,a.kt)("p",null,"If you want to share your plugin with the wider BuildBuddy community, you can submit it to our plugin library ",(0,a.kt)("a",{parentName:"p",href:"/plugins#share"},"here"),"."),(0,a.kt)("h2",{id:"uninstalling-a-plugin"},"Uninstalling a plugin"),(0,a.kt)("p",null,"You can uninstall a plugin at any time by removing it from the ",(0,a.kt)("inlineCode",{parentName:"p"},"plugins:")," block of your ",(0,a.kt)("inlineCode",{parentName:"p"},"buildbuddy.yaml")," file."))}d.isMDXComponent=!0}}]);